"use strict";(self.webpackChunktest_site=self.webpackChunktest_site||[]).push([[26],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>k});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),d=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=d(e.components);return a.createElement(l.Provider,{value:t},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=d(n),h=r,k=p["".concat(l,".").concat(h)]||p[h]||u[h]||o;return n?a.createElement(k,i(i({ref:t},c),{},{components:n})):a.createElement(k,i({ref:t},c))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:r,i[1]=s;for(var d=2;d<o;d++)i[d]=n[d];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},40388:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>d});var a=n(87462),r=(n(67294),n(3905));const o={sidebar_label:"Attendee Ticket Page Code"},i="Attendee Ticket Page Code",s={unversionedId:"Tutorials/Advanced/ticketing/user-code",id:"version-2.0/Tutorials/Advanced/ticketing/user-code",title:"Attendee Ticket Page Code",description:"Introduction",source:"@site/versioned_docs/version-2.0/Tutorials/Advanced/ticketing/user-code.md",sourceDirName:"Tutorials/Advanced/ticketing",slug:"/Tutorials/Advanced/ticketing/user-code",permalink:"/docs/2.0/Tutorials/Advanced/ticketing/user-code",draft:!1,editUrl:"https://github.com/keypom/keypom-docs/tree/main/versioned_docs/version-2.0/Tutorials/Advanced/ticketing/user-code.md",tags:[],version:"2.0",frontMatter:{sidebar_label:"Attendee Ticket Page Code"},sidebar:"Tutorials",previous:{title:"App Design",permalink:"/docs/2.0/Tutorials/Advanced/ticketing/react-outline"},next:{title:"Scanner Code",permalink:"/docs/2.0/Tutorials/Advanced/ticketing/scanner-code"}},l={},d=[{value:"Introduction",id:"introduction",level:2},{value:"<code>App.js</code>",id:"appjs",level:2},{value:"Setting Up",id:"setting-up",level:3},{value:"Rendering",id:"rendering",level:3},{value:"Full Code",id:"full-code",level:3},{value:"<code>Qrcode.js</code>",id:"qrcodejs",level:2},{value:"<code>Keyinfo.js</code>",id:"keyinfojs",level:2},{value:"Conclusion",id:"conclusion",level:2}],c={toc:d},p="wrapper";function u(e){let{components:t,...o}=e;return(0,r.kt)(p,(0,a.Z)({},c,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"attendee-ticket-page-code"},"Attendee Ticket Page Code"),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"In the previous section, you broke down the flow and logic of the ticket app. You also learned what Keypom information is needed in order to render the pages properly. "),(0,r.kt)("p",null,"In this tutorial, you'll learn about the actual code needed to create the attendee ticket page for your seamless ticketing system."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"The focus of this section will be on the Keypom aspects of each script, such as getting key information and using it. "),(0,r.kt)("p",{parentName:"admonition"},"The full code for each script will be shown, with highlights. For React resources, see ",(0,r.kt)("a",{parentName:"p",href:"https://reactjs.org/docs/hello-world.html"},"here")," as a starting point.")),(0,r.kt)("p",null,"Recall, from the ",(0,r.kt)("a",{parentName:"p",href:"/docs/2.0/Tutorials/Advanced/ticketing/introduction"},"introduction")," that your code had the following outline."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"/ticket-app-skeleton\n\u2514\u2500\u2500 components\n\u2502    \u2514\u2500\u2500 scanner.js\n\u2502    \u2514\u2500\u2500 qrcode.js\n\u2514\u2500\u2500 state\n\u2502    \u2514\u2500\u2500 App.js\n\u2502    \u2514\u2500\u2500 keyInfo.js\n\u2514\u2500\u2500 utils\n\u2502    \u2514\u2500\u2500 allowEntry.js\n\u2502    \u2514\u2500\u2500 createTickDrop.js\n\u2502    \u2514\u2500\u2500 testTickDrop.js\n\u2514\u2500\u2500 package.json\n")),(0,r.kt)("p",null,"This tutorial will be covering the code in ",(0,r.kt)("inlineCode",{parentName:"p"},"App.js"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"KeyInfo.js"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"qrcode.js"),"."),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"appjs"},(0,r.kt)("inlineCode",{parentName:"h2"},"App.js")),(0,r.kt)("h3",{id:"setting-up"},"Setting Up"),(0,r.kt)("p",null,"The primary purpose of ",(0,r.kt)("inlineCode",{parentName:"p"},"App.js")," is to display the different states of the attendee ticket page. This will involve getting the current key uses, and then rendering based on the value returned. "),(0,r.kt)("p",null,"The first step is to initialize a connection to NEAR and setup all the state variables that will be needed to render the page. "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"reference showLineNumbers",reference:!0,showLineNumbers:!0},"https://github.com/keypom/keypom-docs-examples/blob/4c8f86dab842c16e9c2bc6ad6f22e1eee2dced9e/advanced-tutorials/ticket-app/state/App.js#L13-L57\n")),(0,r.kt)("p",null,"When the page is loaded, the function ",(0,r.kt)("inlineCode",{parentName:"p"},"setup")," is called and the URL is parsed for ",(0,r.kt)("inlineCode",{parentName:"p"},"contractId")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"privateKey"),". These will be stored in their own respective state  variables for further use."),(0,r.kt)("p",null,"Once the URL has been parsed and the resulting values stored, ",(0,r.kt)("inlineCode",{parentName:"p"},"connectNear")," is called. This function handles the NEAR connection, as well as the Keypom connection."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"When connecting to NEAR, a ",(0,r.kt)("inlineCode",{parentName:"p"},"BrowserLocalStorageKeyStore")," is used rather than an ",(0,r.kt)("inlineCode",{parentName:"p"},"UnencryptedFileSystemKeyStore"),". This will create a key store in the user's browser for future use. For more on key stores, see ",(0,r.kt)("a",{parentName:"p",href:"https://docs.near.org/tools/near-api-js/quick-reference#key-store"},"here"))),(0,r.kt)("p",null,"With the NEAR connection established, your browser can now talk to the NEAR blockchain. The next step, is to call ",(0,r.kt)("inlineCode",{parentName:"p"},"initKeypom"),". This initializes the SDK to allow for interactions with the Keypom smart contracts."),(0,r.kt)("p",null,"After the Keypom initialization is complete, the QR code information can be created following the format ",(0,r.kt)("inlineCode",{parentName:"p"},"${contractId}/${privKey}"),"."),(0,r.kt)("h3",{id:"rendering"},"Rendering"),(0,r.kt)("p",null,"The process of rendering is simple: retrieve the key's current use number, and render the page differently based on the stages outlined in the ",(0,r.kt)("a",{parentName:"p",href:"/docs/2.0/Tutorials/Advanced/ticketing/react-outline"},"App Design"),". "),(0,r.kt)("p",null,"The information is passed into both a QR code component and a KeyInfo component. The ",(0,r.kt)("inlineCode",{parentName:"p"},"KeyInfo")," component takes in both the Keypom contract and private key. It then calls ",(0,r.kt)("inlineCode",{parentName:"p"},"getKeyInformation")," and updates the ",(0,r.kt)("inlineCode",{parentName:"p"},"curUse")," state variable accordingly. ",(0,r.kt)("inlineCode",{parentName:"p"},"QRCode")," uses the ",(0,r.kt)("inlineCode",{parentName:"p"},"qrcode.react")," library to display a QR code based on a string input."),(0,r.kt)("p",null,"The following table outlines what the page should render based on a set of conditions including the current key use. "),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Condition and Description")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Render")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},(0,r.kt)("inlineCode",{parentName:"strong"},"curUse")," is 1"),": The attendee ticket page should show a QR code representing the ticket data (contract and secret key). The ",(0,r.kt)("inlineCode",{parentName:"td"},"QrCode")," component is rendered by passing in the ",(0,r.kt)("inlineCode",{parentName:"td"},"link")," state variable created earlier."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("p",{align:"center"}," ",(0,r.kt)("img",{src:n(1398).default,width:"80%",height:"80%",alt:"ticketing",class:"rounded-corners"})))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},(0,r.kt)("inlineCode",{parentName:"strong"},"curUse")," is 2"),": The first claim was done by the host, and thus should give the user the option to claim their POAP. This is done with the same linkdrop link."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("p",{align:"center"},(0,r.kt)("img",{src:n(4682).default,width:"80%",height:"80%",alt:"ticketing",class:"rounded-corners"})))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},(0,r.kt)("inlineCode",{parentName:"strong"},"curUse")," is 0"),": The second claim was used, and thus the key was depleted and deleted. Here, the user will be given resources to continue learning about NEAR. You can choose to show anything here."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("p",{align:"center"},(0,r.kt)("img",{src:n(37019).default,width:"80%",height:"80%",alt:"ticketing",class:"rounded-corners"})))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"This should act as a landing page for your event and will be shown if any URL is invalid. In this case, ",(0,r.kt)("inlineCode",{parentName:"td"},"curUse")," is 0 ",(0,r.kt)("strong",{parentName:"td"},"and")," splitRes","[3]"," is '' or undefined"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("p",{align:"center"},(0,r.kt)("img",{src:n(61465).default,width:"80%",height:"80%",alt:"ticketing",class:"rounded-corners"})))))),(0,r.kt)("p",null,"The code to render can be found in the exandable section below. "),(0,r.kt)("details",null,(0,r.kt)("summary",null,"app.js rendering code"),(0,r.kt)("p",null,(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"reference showLineNumbers",reference:!0,showLineNumbers:!0},"https://github.com/keypom/keypom-docs-examples/blob/4c8f86dab842c16e9c2bc6ad6f22e1eee2dced9e/advanced-tutorials/ticket-app/state/App.js#L54-L134\n")))),(0,r.kt)("h3",{id:"full-code"},"Full Code"),(0,r.kt)("p",null,"The full code, including the set up and the rendering, can be seen below."),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Full app.js code"),(0,r.kt)("p",null,(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"reference",reference:!0},"https://github.com/keypom/keypom-docs-examples/blob/4c8f86dab842c16e9c2bc6ad6f22e1eee2dced9e/advanced-tutorials/ticket-app/state/App.js#L1-L136\n")))),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"qrcodejs"},(0,r.kt)("inlineCode",{parentName:"h2"},"Qrcode.js")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Qrcode.js")," is a simple component that returns a QR code based on the string passed in. On the attendee ticket page, this is the linkdrop URL for the host to scan. "),(0,r.kt)("p",null,"The full code can be seen below. "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:"reference",reference:!0},"https://github.com/keypom/keypom-docs-examples/blob/4c8f86dab842c16e9c2bc6ad6f22e1eee2dced9e/advanced-tutorials/ticket-app/components/qrcode.js#L1-L22\n")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"keyinfojs"},(0,r.kt)("inlineCode",{parentName:"h2"},"Keyinfo.js")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Keyinfo.js")," is responsible for updating Keypom related state variables, ",(0,r.kt)("inlineCode",{parentName:"p"},"pubKey"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"curUse"),". "),(0,r.kt)("p",null,"When ",(0,r.kt)("inlineCode",{parentName:"p"},"curUse")," is 1 and the QR code is being rendered, the public key and use number is shown for educational purposes."),(0,r.kt)("p",null,"A ",(0,r.kt)("inlineCode",{parentName:"p"},"useEffect")," hook is used to update the needed Keypom state variables whenever the ",(0,r.kt)("inlineCode",{parentName:"p"},"KeyInfo")," component is rendered. To do this, two SDK functions are used: ",(0,r.kt)("a",{parentName:"p",href:"/docs/2.0/keypom-sdk/Core/modules#getpubfromsecret"},(0,r.kt)("inlineCode",{parentName:"a"},"getPubFromSecret"))," to get the public key and ",(0,r.kt)("a",{parentName:"p",href:"/docs/2.0/keypom-sdk/Core/modules#getkeyinformation"},(0,r.kt)("inlineCode",{parentName:"a"},"getKeyInformation"))," to get the current key use. This can be seen below. "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:"reference",reference:!0},"https://github.com/keypom/keypom-docs-examples/blob/4c8f86dab842c16e9c2bc6ad6f22e1eee2dced9e/advanced-tutorials/ticket-app/state/keyInfo.js#L6-L42\n")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"conclusion"},"Conclusion"),(0,r.kt)("p",null,"In this section, you learned about the 3 components that make up the attendee ticket page: ",(0,r.kt)("inlineCode",{parentName:"p"},"App.js"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"Qrcode.js"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"KeyInfo.js"),"."),(0,r.kt)("p",null,"In summary, ",(0,r.kt)("inlineCode",{parentName:"p"},"App.js"),' is the "homepage" of the attendee ticket page and takes care of setting up all the state variables based on the URL and then rendering the page. ',(0,r.kt)("inlineCode",{parentName:"p"},"Qrcode.js")," simply renders a QR code based on an input string. ",(0,r.kt)("inlineCode",{parentName:"p"},"KeyInfo")," is in charge of updating all Keypom state variables whenever ",(0,r.kt)("inlineCode",{parentName:"p"},"App.js")," re-renders. "),(0,r.kt)("p",null,"You also went through the code for each of these components and saw the expected ",(0,r.kt)("a",{parentName:"p",href:"/docs/2.0/Tutorials/Advanced/ticketing/user-code#rendering"},"render results"),". "),(0,r.kt)("p",null,"In the next section, you'll be going through a similar process with the scanner page."))}u.isMDXComponent=!0},61465:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});const a=n.p+"assets/images/claim-0-4fdd6586dc454be2277ec45438548641.png"},1398:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});const a=n.p+"assets/images/claim-1-30b51dc97531d98f71fae60db7e00de0.png"},4682:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});const a=n.p+"assets/images/claim-2-c6e5113256b8ff16852b4e52641e6641.png"},37019:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});const a=n.p+"assets/images/claim-3-77b384883216f1568766d53a64f5b864.png"}}]);